<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Benoapp CalorÃ­as & Macros</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#22c55e">
<link rel="apple-touch-icon" href="icon-192.png">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:Arial;background:#0f172a;color:white;margin:0;padding:20px}
.container{max-width:1400px;margin:auto;background:#111827;padding:20px;border-radius:15px}
input,select,button{padding:10px;margin:5px;border-radius:8px;border:none}
button{background:#22c55e;color:white;font-weight:bold;cursor:pointer}
button:hover{opacity:.85}
table{width:100%;margin-top:20px;border-collapse:collapse}
th,td{padding:10px;text-align:center;border-bottom:1px solid #374151}
canvas{background:white;border-radius:10px;padding:8px}

.dashboard{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:15px}
.card{background:#1f2937;padding:10px;border-radius:10px;text-align:center}
.progress{background:#374151;border-radius:10px;height:16px;margin-top:5px}
.bar{height:100%;background:#22c55e;width:0%}

.charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px}
.chart-box canvas{height:140px !important}

.meals-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-top:20px}
.meal-box{background:#020617;padding:10px;border-radius:10px}

.install-box{margin-top:15px;padding:10px;background:#020617;border-radius:10px;text-align:center}
</style>
</head>
<body>

<div class="container">
<h1>ğŸ“Š BenoApp CalorÃ­as & Macronutrientes</h1>

<div class="install-box">
<button id="installBtn" style="display:none">ğŸ“² Instalar App</button>
</div>

<!-- FECHA -->
<h3>ğŸ“… Historial por fecha</h3>
<input type="date" id="datePicker" onchange="changeDate()">
<button onclick="repeatDay()">ğŸ“‹ Repetir dÃ­a anterior</button>

<!-- DASHBOARD -->
<div class="dashboard">
<div class="card"><h4>Kcal</h4><h2 id="dashKcal">0</h2></div>
<div class="card"><h4>ProteÃ­na</h4><h2 id="dashPro">0</h2></div>
<div class="card"><h4>Carbs</h4><h2 id="dashCar">0</h2></div>
<div class="card"><h4>Grasas</h4><h2 id="dashFat">0</h2></div>
</div>

<!-- PROGRESO -->
<h3>ğŸ¯ Progreso diario</h3>
Kcal<div class="progress"><div id="barKcal" class="bar"></div></div>
ProteÃ­na<div class="progress"><div id="barPro" class="bar"></div></div>
Carbs<div class="progress"><div id="barCar" class="bar"></div></div>
Grasas<div class="progress"><div id="barFat" class="bar"></div></div>

<!-- PERFIL -->
<h3>ğŸ‘¤ Requerimientos</h3>
<input id="reqCal" type="number" placeholder="CalorÃ­as">
<input id="reqPro" type="number" placeholder="ProteÃ­na">
<input id="reqCar" type="number" placeholder="Carbs">
<input id="reqFat" type="number" placeholder="Grasas">
<button onclick="saveProfile()">Guardar</button>

<!-- BUSCADOR -->
<h3>ğŸ” Buscar alimento</h3>
<input id="searchFood" placeholder="Buscar..." oninput="searchDB()">
<select id="foodSelect" size="6" style="width:100%"></select>
<button onclick="fillFromDB()">Autocompletar</button>

<!-- PORCIÃ“N -->
<h3>âš–ï¸ PorciÃ³n</h3>
<input type="number" id="grams" placeholder="Gramos" oninput="applyCustomGrams()">

<!-- AÃ‘ADIR -->
<h3>ğŸ½ï¸ AÃ±adir consumo</h3>
<select id="mealType">
<option>Desayuno</option>
<option>Almuerzo</option>
<option>Cena</option>
<option>Snacks</option>
</select>

<input id="food" placeholder="Comida">
<input id="calories" type="number" placeholder="Kcal">
<input id="protein" type="number" placeholder="ProteÃ­na">
<input id="carbs" type="number" placeholder="Carbs">
<input id="fat" type="number" placeholder="Grasas">
<button onclick="addFood()">Agregar</button>

<!-- TABLA -->
<table>
<thead><tr><th>Comida</th><th>Tipo</th><th>Kcal</th><th>P</th><th>C</th><th>G</th><th>ğŸ—‘ï¸</th></tr></thead>
<tbody id="foodTable"></tbody>
</table>

<!-- DIVISIÃ“N -->
<div class="meals-grid">
<div class="meal-box"><h4>Desayuno</h4><div id="mealDes"></div></div>
<div class="meal-box"><h4>Almuerzo</h4><div id="mealAlm"></div></div>
<div class="meal-box"><h4>Cena</h4><div id="mealCena"></div></div>
<div class="meal-box"><h4>Snacks</h4><div id="mealSnack"></div></div>
</div>

<!-- GRÃFICAS -->
<div class="charts-grid">
<div class="chart-box"><h3>Macros diario</h3><canvas id="macroChart"></canvas></div>
<div class="chart-box"><h3>Kcal semanales</h3><canvas id="weeklyChart"></canvas></div>
</div>

</div>

<script>

/* PERFIL */
let profile=JSON.parse(localStorage.getItem("userProfile"))||{calories:2000,protein:150,carbs:250,fat:70};
reqCal.value=profile.calories;reqPro.value=profile.protein;reqCar.value=profile.carbs;reqFat.value=profile.fat;
function saveProfile(){
profile={calories:+reqCal.value,protein:+reqPro.value,carbs:+reqCar.value,fat:+reqFat.value};
localStorage.setItem("userProfile",JSON.stringify(profile));
render();}

/* HISTORIAL */
let history=JSON.parse(localStorage.getItem("dailyHistory"))||{};
let today=new Date().toISOString().slice(0,10);
let currentDate=today;
datePicker.value=currentDate;
let list=history[currentDate]||[];

function saveDay(){history[currentDate]=list;localStorage.setItem("dailyHistory",JSON.stringify(history));}
function changeDate(){currentDate=datePicker.value;list=history[currentDate]||[];render();}
function repeatDay(){const d=new Date(currentDate);d.setDate(d.getDate()-1);list=[...(history[d.toISOString().slice(0,10)]||[])];saveDay();render();}

/* BD */
let db=JSON.parse(localStorage.getItem("foodDB"))||[[
  {
    "name": "Arroz blanco 100g",
    "cal": 130,
    "pro": 2.7,
    "car": 28,
    "fat": 0.3
  },
  {
    "name": "Arroz integral 100g",
    "cal": 111,
    "pro": 2.6,
    "car": 23,
    "fat": 0.9
  },
  {
    "name": "Pollo pechuga 100g",
    "cal": 165,
    "pro": 31,
    "car": 0,
    "fat": 3.6
  },
  {
    "name": "Pollo muslo 100g",
    "cal": 209,
    "pro": 26,
    "car": 0,
    "fat": 10.9
  },
  {
    "name": "Carne res 100g",
    "cal": 250,
    "pro": 26,
    "car": 0,
    "fat": 15
  },
  {
    "name": "Carne molida 100g",
    "cal": 254,
    "pro": 17,
    "car": 0,
    "fat": 20
  },
  {
    "name": "Cerdo 100g",
    "cal": 242,
    "pro": 27,
    "car": 0,
    "fat": 14
  },
  {
    "name": "Pavo pechuga 100g",
    "cal": 135,
    "pro": 30,
    "car": 0,
    "fat": 1
  },
  {
    "name": "AtÃºn agua 100g",
    "cal": 116,
    "pro": 26,
    "car": 0,
    "fat": 1
  },
  {
    "name": "SalmÃ³n 100g",
    "cal": 208,
    "pro": 20,
    "car": 0,
    "fat": 13
  },
  {
    "name": "Tilapia 100g",
    "cal": 96,
    "pro": 20,
    "car": 0,
    "fat": 1.7
  },
  {
    "name": "Sardinas 100g",
    "cal": 208,
    "pro": 25,
    "car": 0,
    "fat": 11
  },
  {
    "name": "Huevo entero",
    "cal": 70,
    "pro": 6,
    "car": 0.6,
    "fat": 5
  },
  {
    "name": "Clara huevo",
    "cal": 17,
    "pro": 3.6,
    "car": 0.2,
    "fat": 0
  },
  {
    "name": "Leche entera",
    "cal": 61,
    "pro": 3.2,
    "car": 5,
    "fat": 3.3
  },
  {
    "name": "Leche descremada",
    "cal": 34,
    "pro": 3.4,
    "car": 5,
    "fat": 0.1
  },
  {
    "name": "Queso mozzarella",
    "cal": 280,
    "pro": 28,
    "car": 3,
    "fat": 17
  },
  {
    "name": "Queso cheddar",
    "cal": 402,
    "pro": 25,
    "car": 1.3,
    "fat": 33
  },
  {
    "name": "Yogur natural",
    "cal": 59,
    "pro": 10,
    "car": 3.6,
    "fat": 0.4
  },
  {
    "name": "Yogur griego",
    "cal": 97,
    "pro": 9,
    "car": 3.9,
    "fat": 5
  },
  {
    "name": "Pan blanco",
    "cal": 265,
    "pro": 9,
    "car": 49,
    "fat": 3.2
  },
  {
    "name": "Pan integral",
    "cal": 247,
    "pro": 13,
    "car": 41,
    "fat": 4.2
  },
  {
    "name": "Avena 100g",
    "cal": 389,
    "pro": 17,
    "car": 66,
    "fat": 7
  },
  {
    "name": "Granola",
    "cal": 471,
    "pro": 10,
    "car": 64,
    "fat": 20
  },
  {
    "name": "Cereal",
    "cal": 379,
    "pro": 7,
    "car": 84,
    "fat": 1
  },
  {
    "name": "Pasta cocida",
    "cal": 131,
    "pro": 5,
    "car": 25,
    "fat": 1.1
  },
  {
    "name": "Lentejas",
    "cal": 116,
    "pro": 9,
    "car": 20,
    "fat": 0.4
  },
  {
    "name": "Frijoles",
    "cal": 127,
    "pro": 9,
    "car": 23,
    "fat": 0.5
  },
  {
    "name": "Garbanzos",
    "cal": 164,
    "pro": 9,
    "car": 27,
    "fat": 2.6
  },
  {
    "name": "Papa cocida",
    "cal": 87,
    "pro": 2,
    "car": 20,
    "fat": 0.1
  },
  {
    "name": "Papa frita",
    "cal": 312,
    "pro": 3.4,
    "car": 41,
    "fat": 15
  },
  {
    "name": "Batata",
    "cal": 86,
    "pro": 1.6,
    "car": 20,
    "fat": 0.1
  },
  {
    "name": "Yuca",
    "cal": 160,
    "pro": 1.4,
    "car": 38,
    "fat": 0.3
  },
  {
    "name": "Arepa",
    "cal": 218,
    "pro": 5,
    "car": 45,
    "fat": 2
  },
  {
    "name": "Empanada",
    "cal": 298,
    "pro": 10,
    "car": 30,
    "fat": 16
  },
  {
    "name": "Pizza",
    "cal": 266,
    "pro": 11,
    "car": 33,
    "fat": 10
  },
  {
    "name": "Hamburguesa",
    "cal": 295,
    "pro": 17,
    "car": 30,
    "fat": 14
  },
  {
    "name": "Hot dog",
    "cal": 290,
    "pro": 10,
    "car": 18,
    "fat": 21
  },
  {
    "name": "Pollo frito",
    "cal": 320,
    "pro": 20,
    "car": 8,
    "fat": 22
  },
  {
    "name": "Nuggets",
    "cal": 296,
    "pro": 15,
    "car": 18,
    "fat": 20
  },
  {
    "name": "Tocino",
    "cal": 541,
    "pro": 37,
    "car": 1.4,
    "fat": 42
  },
  {
    "name": "JamÃ³n",
    "cal": 145,
    "pro": 21,
    "car": 1.5,
    "fat": 5.5
  },
  {
    "name": "Chorizo",
    "cal": 455,
    "pro": 24,
    "car": 2,
    "fat": 38
  },
  {
    "name": "Salchicha",
    "cal": 301,
    "pro": 12,
    "car": 2,
    "fat": 27
  },
  {
    "name": "Sushi",
    "cal": 130,
    "pro": 6,
    "car": 28,
    "fat": 0.2
  },
  {
    "name": "Ramen",
    "cal": 436,
    "pro": 10,
    "car": 62,
    "fat": 17
  },
  {
    "name": "Manzana",
    "cal": 52,
    "pro": 0.3,
    "car": 14,
    "fat": 0.2
  },
  {
    "name": "Banano",
    "cal": 89,
    "pro": 1.1,
    "car": 23,
    "fat": 0.3
  },
  {
    "name": "Naranja",
    "cal": 47,
    "pro": 0.9,
    "car": 12,
    "fat": 0.1
  },
  {
    "name": "Fresa",
    "cal": 32,
    "pro": 0.7,
    "car": 8,
    "fat": 0.3
  },
  {
    "name": "Mango",
    "cal": 60,
    "pro": 0.8,
    "car": 15,
    "fat": 0.4
  },
  {
    "name": "PiÃ±a",
    "cal": 50,
    "pro": 0.5,
    "car": 13,
    "fat": 0.1
  },
  {
    "name": "Aguacate",
    "cal": 160,
    "pro": 2,
    "car": 9,
    "fat": 15
  },
  {
    "name": "Tomate",
    "cal": 18,
    "pro": 0.9,
    "car": 3.9,
    "fat": 0.2
  },
  {
    "name": "Lechuga",
    "cal": 15,
    "pro": 1.4,
    "car": 2.9,
    "fat": 0.2
  },
  {
    "name": "Zanahoria",
    "cal": 41,
    "pro": 0.9,
    "car": 10,
    "fat": 0.2
  },
  {
    "name": "BrÃ³coli",
    "cal": 55,
    "pro": 3.7,
    "car": 11,
    "fat": 0.6
  },
  {
    "name": "Espinaca",
    "cal": 23,
    "pro": 2.9,
    "car": 3.6,
    "fat": 0.4
  },
  {
    "name": "Pepino",
    "cal": 16,
    "pro": 0.7,
    "car": 4,
    "fat": 0.1
  },
  {
    "name": "Aceite oliva 1 cda",
    "cal": 119,
    "pro": 0,
    "car": 0,
    "fat": 13.5
  },
  {
    "name": "Mantequilla 1 cda",
    "cal": 102,
    "pro": 0.1,
    "car": 0,
    "fat": 11.5
  },
  {
    "name": "Mayonesa 1 cda",
    "cal": 94,
    "pro": 0.1,
    "car": 0.1,
    "fat": 10
  },
  {
    "name": "AzÃºcar 1 cda",
    "cal": 49,
    "pro": 0,
    "car": 13,
    "fat": 0
  },
  {
    "name": "Miel 1 cda",
    "cal": 64,
    "pro": 0.1,
    "car": 17,
    "fat": 0
  },
  {
    "name": "Chocolate negro",
    "cal": 546,
    "pro": 4.9,
    "car": 61,
    "fat": 31
  },
  {
    "name": "Helado",
    "cal": 207,
    "pro": 3.5,
    "car": 24,
    "fat": 11
  },
  {
    "name": "Galletas",
    "cal": 502,
    "pro": 6,
    "car": 64,
    "fat": 24
  },
  {
    "name": "Almendras",
    "cal": 579,
    "pro": 21,
    "car": 22,
    "fat": 50
  },
  {
    "name": "Nueces",
    "cal": 654,
    "pro": 15,
    "car": 14,
    "fat": 65
  },
  {
    "name": "ManÃ­",
    "cal": 567,
    "pro": 26,
    "car": 16,
    "fat": 49
  },
  {
    "name": "Mantequilla manÃ­",
    "cal": 588,
    "pro": 25,
    "car": 20,
    "fat": 50
  },
  {
    "name": "ChÃ­a",
    "cal": 486,
    "pro": 17,
    "car": 42,
    "fat": 31
  },
  {
    "name": "Quinoa",
    "cal": 120,
    "pro": 4.4,
    "car": 21,
    "fat": 1.9
  },
  {
    "name": "ProteÃ­na whey scoop",
    "cal": 120,
    "pro": 24,
    "car": 3,
    "fat": 1
  },
  {
    "name": "Batido proteÃ­na",
    "cal": 180,
    "pro": 30,
    "car": 6,
    "fat": 2
  },
  {
    "name": "CafÃ© negro",
    "cal": 2,
    "pro": 0.3,
    "car": 0,
    "fat": 0
  },
  {
    "name": "Jugo naranja",
    "cal": 45,
    "pro": 0.7,
    "car": 10,
    "fat": 0.2
  },
  {
    "name": "Refresco",
    "cal": 41,
    "pro": 0,
    "car": 10,
    "fat": 0
  },
  {
    "name": "Agua",
    "cal": 0,
    "pro": 0,
    "car": 0,
    "fat": 0
  }
]];
function searchDB(){
foodSelect.innerHTML="";
db.filter(f=>f.name.toLowerCase().includes(searchFood.value.toLowerCase()))
.forEach((f,i)=>foodSelect.innerHTML+=`<option value=${i}>${f.name}</option>`);
}
searchDB();

let baseFood=null;
function fillFromDB(){
const f=db[foodSelect.value];if(!f)return;
baseFood=f;
food.value=f.name;calories.value=f.cal;protein.value=f.pro;carbs.value=f.car;fat.value=f.fat;grams.value=100;
}

function applyCustomGrams(){
if(!baseFood)return;
const m=(+grams.value||0)/100;
calories.value=(baseFood.cal*m).toFixed(0);
protein.value=(baseFood.pro*m).toFixed(1);
carbs.value=(baseFood.car*m).toFixed(1);
fat.value=(baseFood.fat*m).toFixed(1);
}

/* CRUD */
function addFood(){
list.push({food:food.value,type:mealType.value,cal:+calories.value||0,pro:+protein.value||0,car:+carbs.value||0,fat:+fat.value||0});
saveDay();render();}

function deleteFood(i){list.splice(i,1);saveDay();render();}

/* CHARTS */
let macroChart,weeklyChart;

function render(){
foodTable.innerHTML="";
mealDes.innerHTML="";mealAlm.innerHTML="";mealCena.innerHTML="";mealSnack.innerHTML="";

let p=0,c=0,f=0,k=0;

list.forEach((x,i)=>{
p+=x.pro;c+=x.car;f+=x.fat;k+=x.cal;
foodTable.innerHTML+=`<tr><td>${x.food}</td><td>${x.type}</td><td>${x.cal}</td><td>${x.pro}</td><td>${x.car}</td><td>${x.fat}</td><td><button onclick="deleteFood(${i})" style="background:#ef4444">X</button></td></tr>`;

const box=x.type==="Desayuno"?mealDes:x.type==="Almuerzo"?mealAlm:x.type==="Cena"?mealCena:mealSnack;
box.innerHTML+=`${x.food} (${x.cal} kcal)<br>`;
});

dashKcal.textContent=k;dashPro.textContent=p;dashCar.textContent=c;dashFat.textContent=f;

barKcal.style.width=(k/profile.calories*100)+"%";
barPro.style.width=(p/profile.protein*100)+"%";
barCar.style.width=(c/profile.carbs*100)+"%";
barFat.style.width=(f/profile.fat*100)+"%";

/* ---- MACRO CHART ---- */
const macroCanvas=document.getElementById("macroChart");
if(macroCanvas){
const ctx=macroCanvas.getContext("2d");
if(macroChart)macroChart.destroy();
macroChart=new Chart(ctx,{ 
 type:'doughnut',
 data:{
  labels:['ProteÃ­na','Carbs','Grasas'],
  datasets:[{data:[p,c,f]}]
 }
});
}

renderWeekly();
}

function renderWeekly(){
const labels=[],kcals=[];

for(let i=6;i>=0;i--){
 const date=new Date();
 date.setDate(date.getDate()-i);
 const key=date.toISOString().slice(0,10);
 labels.push(key.slice(5));
 kcals.push((history[key]||[]).reduce((a,b)=>a+b.cal,0));
}

const weeklyCanvas=document.getElementById("weeklyChart");
if(weeklyCanvas){
 const ctx=weeklyCanvas.getContext("2d");
 if(weeklyChart)weeklyChart.destroy();
 weeklyChart=new Chart(ctx,{ 
  type:'bar',
  data:{
   labels:labels,
   datasets:[{label:'Kcal',data:kcals}]
  }
 });
}
}

/* INIT */
document.addEventListener("DOMContentLoaded",()=>{
 render();
 registerSW();
});

/* PWA INSTALL */
let deferredPrompt;
const installBtn=document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt",e=>{
 e.preventDefault();
 deferredPrompt=e;
 installBtn.style.display="inline-block";
});

installBtn.addEventListener("click",async()=>{
 if(!deferredPrompt)return;
 deferredPrompt.prompt();
 deferredPrompt=null;
 installBtn.style.display="none";
});

/* SERVICE WORKER */
function registerSW(){
 if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
 }
}
</script>
</body>
</html>

</html>
